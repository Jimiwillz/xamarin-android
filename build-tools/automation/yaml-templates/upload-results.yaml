parameters:
  solution: build-tools/Xamarin.Android.Tools.BootstrapTasks/Xamarin.Android.Tools.BootstrapTasks.csproj
  configuration: $(XA.Build.Configuration)
  artifactName: results

steps:
- powershell: |
    $BuildNumber = "$Env:BUILD_BUILDNUMBER";
    $BuildRevision = $BuildNumber.Substring($BuildNumber.LastIndexOf('-') + 1)
    Write-Host "##vso[task.setvariable variable=BuildRevision;]$BuildRevision"
  condition: eq(variables['agent.os'],'Windows_NT')
  
- bash: |
    BUILD_REVISION=$(echo $BUILD_BUILDNUMBER | cut -d'-' -f 3)
    echo "##vso[task.setvariable variable=BuildRevision]$BUILD_REVISION"
  condition: ne(variables['agent.os'],'Windows_NT')

- task: MSBuild@1
  displayName: package build and test results
  inputs:
    solution: ${{ parameters.solution }}
    configuration: ${{ parameters.configuration }}
    msbuildArguments: /restore /t:Build,ZipBuildStatus,ZipTestResults /p:BuildStatusZipOutputPath=$(Build.ArtifactStagingDirectory) /p:TestResultZipOutputPath=$(Build.ArtifactStagingDirectory)
  condition: always()

- task: PublishPipelineArtifact@0
  displayName: upload build and test results
  inputs:
    artifactName: ${{ parameters.artifactName }} (Run $(BuildRevision))
    targetPath: $(Build.ArtifactStagingDirectory)
  condition: always()
